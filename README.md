# likeme
Интернет магазин с приминением k8s, ELK stack, golang на бэкенде, vue на фронте и монолитом на yii2
=====================

Введение
-----------------------------------
В данной сборке используется такой стек технологий:

* kubernetes. Для оркестрации всем содержимым сборки
* ELK stack. Для логирования, а также для работы с полнотекстовым поиском( онли elasticsearch для полнотекстового поиска конечно-же :) );
* 3 БД mysql с phpmyadmin под каждую. Одна для товаров, категорий, фильтров и остального, что связно непосредственно с интернет магазином. Вторая для хранения информации связанной с заказми, чтоб не грузить БД, которая создана под товары, т.к. она и так нагружена. 3-я для хранения остальных данных: страниц, акций, переводов, настроек и т.д.;
* redis. Можно использовать для хранения любых временных данных, но т.к. магазин в этой сборке уже внедрен на yii2, то тут redis используется для хранения информации о корзине и избранных товарах;
* микросервисы на golang, которые отдают инфу в json, для разгона фронта приложения и всех остальных приложений, которым нужен доступ по api(моб. например);
* приложение - монолит на yii2, с удобной и многофункциональной админкой и vue.js на фронте. Микросервисы на go используются, в приложении только на фронте. логирование с помощью logstash подключено и на фронте и бэкеде. На бэке для слежки за сотрудниками через kibana, на фронте для логирования ошибок. Также полнотекстовый поиск на elasticsearch, как на фронте, так и бэке;
* Telegram бот на python (не замудренный), просто для поиска товаров по категориям и полнотекстовом поиску;
* Микросервис, использующий машинное зрение для оптимизации изображений на python;
* Андроид приложение, уже с готовым бэкендом и фронтом. На бэке использует микросервисы golang для получения данных;
* тесты. Только для монолитного приложения. В ближайшее время руки до тестов микросервисов и содержимого приложения, которое касается k8s не дойдут.

### Начало работы

Желательно работать в линуксе, если нужно работать под винду или мак ось, то нужно установить docker и kubernetes под свою ось и запуск файла install_kube.sh вам не подойдет, нужно устанавливать docker и k8s без этого файла или добавить в него свои инстукции.

Файл install_kube.sh, в корне проекта установит все нужное на систему. Можно открыть и посмотреть все, что он будет делать, т.к. в файле есть подробные комментарии к коммандам, ссылки на информацию по установке и вывод, который был у меня и после все работало отлично. Открой файл у себя в редакторе, чтоб понимать пошло ли все ок и запусти файл, выполнив команду

```
sh install_kube.sh
```

Дальше файл init_env.sh. Этот листинг комманд установит nodejs, npm, gulp и webpack на машину. Выполни

```
sh init_env.sh
```

Если еще не пришлось рестартовать машину, то перезапусти ее.

Жрет єта сборка много ОЗУ и ресурсов процессора, т.к. приложение сложное. Если мало ОЗУ или слабій проц, то можно попробовать запустить все на нем. Для этого открой файл start_cluster.sh в текстовом редакторе и подкорректируй флаги значение флагов --memory(ОЗУ), количество ядер проца --cpus и --disk-size память выделяемая под приложение под себя.

После в этом-же файле замени /programming/projects/likeme_kuber/ (и тильду спереди тоже, не могу вставить ее сюда) на путь в котором лежит это readme

После в корне проекта запусти листинг комманд start_cluster.sh

```
sh start_cluster.sh
```


Если получился такой вывод открылся дашборд кубернетес(не обязательно, главное чтоб с в консоле такое-же было, как сгенерить свой дашборд напишу позже, а может тут уже будет приложуха с дашбордом), то ПОЗДРОВЛЯЮ, все прошло отлично

![success_minikube_start](https://i.imgur.com/tByWwJa.png)

### Стартуем монолит

Для дальнейшей работы, у тебя уже должен быть открыт дашборд k8s в браузере

![k8s_dashboard](https://i.imgur.com/7Hm4oFH.png)

Переходи в дирокторию monolit/kuber и там увидешь все деплойменты и сервисы для старта монолита, redis и ELK. Можешь посмотреть файлы, которые там есть, если хочешь переконфижить что-то(подробнее о том, что творится там описано в readme. которе в этой папке).

Для старта, нужно запустить листинг комманд линукс init_monolit.sh(в файле есть комментарии, что и за что отвечает). Он запустит все deplyments и services и установит значение переменной max_map_count в нужное значение(нужно для elasticsearch)

```
sh init_monolit.sh
```

Вывод, в консоле, должен быть типа этого:

![started_monolit](https://i.imgur.com/FbSrzDS.png)

Только вместо unchanged, должно быть created.